{{ define "section_header" }}
    {{ partial "date-selector-nav-tweet.html" . }}
{{ end }}

{{ define "main" }}
    {{ partial "notification.html" . }}

    <section class="page-section">
        <div class="page-section__content">
            <ul class="article-container tweet-container" id="tweet-list">
                {{/* Tweetã‚»ã‚¯ã‚·ãƒ§ãƒ³ã®ãƒšãƒ¼ã‚¸ã§ã€tweet_placeãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãŒç¾åœ¨ã®ã‚¿ãƒ¼ãƒ ã¨ä¸€è‡´ã™ã‚‹ã‚‚ã®ã‚’è¡¨ç¤º */}}
                {{ $currentPlace := "" }}
                {{ if .Data.Term }}
                    {{ $currentPlace = .Data.Term }}
                {{ end }}
                {{ range where (where .Site.RegularPages "Section" "tweet") "Params.tweet_place" $currentPlace }}
                    <article class="article-item tweet-item">
                        <div class="tweet-item__bubble">
                            <div class="tweet-item__text{{ if .Params.voice }} tweet-item__text--{{ .Params.voice }}{{ end }}">{{ .Content }}</div>
                            <div class="tweet-item__bottom">
                                {{ if .Params.tweet_tag }}
                                    <div class="tweet-item__tags">
                                        {{ $sortedTags := sort .Params.tweet_tag }}
                                        {{ range $sortedTags }}
                                            {{ $label := . }}
                                            {{ $taxonomy := "" }}
                                            {{ range $term, $pages := $.Site.Taxonomies.tweet_tag }}
                                                {{ if eq ($term | urlize) ($label | urlize) }}
                                                    {{ $taxonomy = $pages }}
                                                {{ end }}
                                            {{ end }}
                                            {{ with $taxonomy }}
                                                <a href="{{ .Page.RelPermalink }}" class="tag">{{ $label }}</a>
                                            {{ else }}
                                                <span class="tag">{{ $label }}</span>
                                            {{ end }}
                                        {{ end }}
                                    </div>
                                {{ end }}
                                <div class="tweet-item__footer">
                                    <p class="date tweet-item__date">
                                        {{ .Date | dateFormat "Jan 2" }} Â· {{ .Date | dateFormat "Mon" }} Â· {{ .Date | dateFormat "2006" }}{{ if .Params.tweet_place }} Â· <span class="tweet-item__place-link">{{ .Params.tweet_place }}</span>{{ end }}
                                    </p>
                                </div>
                            </div>
                            <div class="tweet-item__emoji" aria-label="{{ if .Params.voice }}{{ .Params.voice }}{{ else }}é€šå¸¸ã®å£°{{ end }}">{{ if .Params.emoji }}{{ .Params.emoji }}{{ else }}ğŸ˜Š{{ end }}</div>
                        </div>
                    </article>
                {{ end }}
            </ul>
        </div>
    </section>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const yearSelector = document.querySelector('.date-selector-nav__year-selector');
            const yearDisplay = document.getElementById('year-display');
            const prevYearBtn = document.getElementById('prev-year');
            const nextYearBtn = document.getElementById('next-year');
            const monthFilters = document.getElementById('date-selector-nav__month-filters');
            
            if (!yearSelector || !yearDisplay || !prevYearBtn || !nextYearBtn || !monthFilters) {
                return;
            }
            
            let currentYear = parseInt(yearDisplay.textContent);
            const minYear = parseInt(yearSelector.getAttribute('data-min-year')) || currentYear;
            const maxYear = parseInt(yearSelector.getAttribute('data-max-year')) || currentYear;

            function updateMonthButtons(year) {
                // <a>ã‚¿ã‚°ã¨<span>ã‚¿ã‚°ã®ä¸¡æ–¹ã‚’å¯¾è±¡ã«ã™ã‚‹
                const buttons = monthFilters.querySelectorAll('a, span');
                
                buttons.forEach(btn => {
                    const btnYear = btn.getAttribute('data-year');
                    if (btnYear === String(year)) {
                        // è¡¨ç¤ºå¹´ã®å ´åˆã¯ã€display: noneã‚’å‰Šé™¤ï¼ˆä»–ã®styleå±æ€§ã¯ä¿æŒï¼‰
                        const currentStyle = btn.getAttribute('style') || '';
                        if (currentStyle.includes('display: none')) {
                            const newStyle = currentStyle.replace(/display:\s*none;?\s*/gi, '').trim();
                            if (newStyle) {
                                btn.setAttribute('style', newStyle);
                            } else {
                                btn.removeAttribute('style');
                            }
                        }
                    } else {
                        // éè¡¨ç¤ºå¹´ã®å ´åˆã¯ã€display: noneã‚’è¿½åŠ ï¼ˆä»–ã®styleå±æ€§ã¯ä¿æŒï¼‰
                        const currentStyle = btn.getAttribute('style') || '';
                        if (!currentStyle.includes('display: none')) {
                            const newStyle = currentStyle ? currentStyle + '; display: none' : 'display: none';
                            btn.setAttribute('style', newStyle);
                        }
                    }
                });
            }

            function updateYearButtons() {
                if (currentYear <= minYear) {
                    prevYearBtn.classList.add('disabled');
                    prevYearBtn.disabled = true;
                } else {
                    prevYearBtn.classList.remove('disabled');
                    prevYearBtn.disabled = false;
                }
                
                if (currentYear >= maxYear) {
                    nextYearBtn.classList.add('disabled');
                    nextYearBtn.disabled = true;
                } else {
                    nextYearBtn.classList.remove('disabled');
                    nextYearBtn.disabled = false;
                }
            }

            prevYearBtn.addEventListener('click', function() {
                if (currentYear > minYear) {
                    currentYear--;
                    yearDisplay.textContent = currentYear;
                    updateMonthButtons(currentYear);
                    updateYearButtons();
                }
            });

            nextYearBtn.addEventListener('click', function() {
                if (currentYear < maxYear) {
                    currentYear++;
                    yearDisplay.textContent = currentYear;
                    updateMonthButtons(currentYear);
                    updateYearButtons();
                }
            });

            // åˆæœŸçŠ¶æ…‹ã§æœˆã®ãƒœã‚¿ãƒ³ã¨å¹´é¸æŠãƒœã‚¿ãƒ³ã‚’æ›´æ–°
            updateMonthButtons(currentYear);
            updateYearButtons();
        });
    </script>
{{ end }}

{{ define "secondary" }}
    {{/* ã‚¿ã‚°ä¸€è¦§ã¯è¡¨ç¤ºã—ãªã„ */}}
{{ end }}


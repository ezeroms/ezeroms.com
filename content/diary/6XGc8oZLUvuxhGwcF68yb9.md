---
title: "Hugo + Netlify の静的ブログに Contentful で管理画面を取り付けた"
date: 2025-11-16T17:37:29.106Z
slug: "6XGc8oZLUvuxhGwcF68yb9"
tags: []
draft: false
---

背景
--

僕のブログは、昔ながらの静的サイトという形にこだわって作っている。つまり、サイト閲覧時にサーバー側で動的なページ生成を行わず、そこに置かれていた HTML ファイルがそのままブラウザに届く仕組みだ。

このことにこだわっているのは、ローディングが阿部寛的に爆速であるとか、セキュリティリスクが抑えられるとか、それっぽい理由も挙げられるが、実のところは僕の嗜好（フェティッシュ）でしかない。静的サイトにはロマンがある。そこには、昔ながらのインターネットの美しさがあり、僕はそれをいつまでも大事にしたいと思っているのだ。

しかし、さすがに毎回 HTML ファイルを書いているわけではない。初期のウェブ文化も HTML を手書きするところから始まったが、記事が増えるにつれてそれらを効率的に管理する仕組みが求められていった。そうしてこの世に WordPress や Movable Type のような CMS が生まれたわけだが、いずれも、「書く」ことと「公開する」ことの間にある不便さを取り除くための進歩だったといえる。

では、僕が静的サイトにこだわりながら、この更新のしやすさ問題をどうやって解決しているのか。その答えが Hugo という静的サイトジェネレーターだ。

Hugo は、Markdown で書いた記事を HTML に変換し、ファイル一式をまとめて静的なサイトとして出力してくれるものだ。ローカルで Markdown（.md）ファイルを書いて GitHub に push すれば、あとは Netlify が自動的にビルドして公開してくれる。md ファイルを構造的に保管しておくことで、コンテンツ管理をおこなっているのである。

当初は、ローカル環境で Markdown（md）ファイルを書き、それを GitHub に push してサイトを更新していた。ただ、この方法だと外出先から気軽に投稿できない。次第に「ブラウザでサッと更新できる管理画面がほしい」と思うようになり、途中から NetlifyCMS（旧 DecapCMS）を導入して、ブラウザ上に簡易的な CMS を持たせる運用に切り替えた。

NetlifyCMS の仕組みはシンプルで、裏側では次のように動く。

1.  管理画面で記事を書く
    
2.  NetlifyCMS が md ファイルを自動生成して GitHub に commit
    
3.  Netlify がコミットを検知して再ビルド
    
4.  サイトが更新される
    

当初はローカル環境で md ファイルを書き、それを GitHub に push してサイトを更新していた。ただ、そのうちブラウザで更新作業をおこないたいと考えるようになり、途中から NetlifyCMS（旧 DecapCMS）を導入して、ブラウザ上に簡易的な管理画面（CMS）を用意する方法に切り替えた。

NetlifyCMS は GitHub のリポジトリを直接編集する仕組みになっており、裏側では次のように動く。

1.  NetlifyCMS = 管理画面で記事を書く
    
2.  NetlifyCMS が md ファイルを自動生成して GitHub に commit
    
3.  Netlify がそれを検知して再ビルド
    
4.  サイトが更新される
    

つまり、本質的には以前と同じ「md → GitHub → Netlify」の流れを維持したまま、編集体験だけをブラウザ側に持ってくるという設計だ。

ところが、ここで思わぬ落とし穴があった。

NetlifyCMS は、日本語入力をしようとすると編集画面がバグり、まともに文章が書けなかったのだ。

この事実に気づいたのは、ひととおり実装が終わった後で、僕はしばらく膝から崩れ落ちていた。ただ、「コミュニティでも報告されているし、そのうち直るだろう」と楽観していたのだが、待てど暮らせど一向に直る気配がない。

その間、僕はずっとテキストエディタで文章を書き、NetlifyCMS にペーストして更新するという、なんともむなしい運用を続けていた。そうして一年半ほどが過ぎ、ようやく「これはもう自分で別の管理画面を用意するしかない」と重い腰を上げることにした。

作業内容
----

選んだのは Contentful。CMS として優れており、API 経由で静的サイトに記事を流し込める。

ここからは、旧構成の課題と、新構成でどのように問題を解消したかを整理する。

### **旧構成**

1.  NetlifyCMS で Markdown を作成・編集
    
2.  NetlifyCMS で Publish → GitHub に commit & push
    
3.  Netlify が GitHub を監視しており、push をトリガーに build
    
4.  Netlify のサーバー上で Hugo が走り content/ 以下の Markdown を読み取り、静的サイトを生成
    
5.  Netlify が公開
    

### **新構成**

1.  Contentful の管理画面で記事を作成・編集
    
2.  記事を Publish（Contentful が Webhook を発火）
    
3.  Netlify が Webhook を受け取り、build を開始
    
4.  build 前処理として Node スクリプトが実行され、Contentful から記事を取得して content/ 以下に
    
5.  Markdown を自動生成
    
6.  Netlify のサーバー上で Hugo が走り、Markdown を読み取って静的サイトを生成
    
7.  Netlify が公開
    

### **新構成で解消したこと、変更の影響**

*   日本語の記事作成ができない NetlifyCMS から脱却、Contentful を使って記事管理ができるようになった。
    
*   Contentful はスマホからも更新ができるため、スマホからの更新ができるようになった。（副産物）
    
*   GitHub を経由しない更新ルートができたため、本番環境の内容と GitHub で管理しているソースコードが一致しなくなった。
    

今後の展望
-----

前項に書いたように、今回の構成変更によって、「本番サイトに反映されている内容」と「GitHub リポジトリにある内容」が一致しないという状況が生まれてしまった。

考えようによっては、「アプリケーションは GitHub に置き、記事データは Contentful に置く」という、いわば「アプリとデータベースの分離」として割り切ることもできる。

ただ、僕としてはこれまで 「すべての記事が GitHub 上で完結している」という状態がとても気に入っていた。

ローカルに clone すれば記事の全履歴が残っているし、検索も diff も効く。静的サイトでありながら、自分だけのアーカイブを GitHub 上に持っているような感覚があった。その状態が崩れるのは正直ちょっと気に食わない。

それに、もし誤って GitHub で編集してしまったときに先祖返りが発生する可能性もある。（これは、そんな運用をするなという話ではあるけれど……。）

この問題をきちんと解決するとしたら、GitHub Actions を使って Contentful → Markdown → GitHub の同期を自動化する、というやり方が考えられる。

GitHub Actions 上で Node.js を起動し、Contentful API から記事データを取得して content/ 以下に Markdown を生成し、最後に git commit & git push でリポジトリを更新する、という処理だ。

実行タイミングとしては、まずは手動トリガーや、daily or weekly の定期実行から始めるのが現実的だろう。もちろん、より丁寧にやるなら Contentful の更新を Webhook で検知し、それをきっかけに GitHub Actions を走らせるほうがスマートだ。

でも、これはこれで、Contentful で Publish → Netlify が反応 → サイト更新、のすぐ後に、今度は GitHub Actions が Contentful を読みに行き、同じ内容を GitHub に push する……という二重更新が発生するので、だいぶキモいかんじもする。

このあたりはもう少し悩みつつ、近日中に GitHub Actions のプロトタイプを作ってみようと思う。

{{ define "main" }}
    {{ partial "notification.html" . }}

    <section class="about-main">
        <div class="about-main__content">
            <!-- „Ç´„Éê„ÉºÁîªÂÉè -->
            <div class="about-cover">
                <img src="/images/about/profile.webp" alt="Profile Picture" class="about-cover__image">
            </div>

            <!-- „Éó„É≠„Éï„Ç£„Éº„É´„ÅÆ„Ç≥„É≥„ÉÜ„É≥„ÉÑ -->
            <div id="profile-content" class="about-content">
                <article class="article-item">
                    <div id="profile"></div>
                    {{ $content := .Content }}
                    {{ $parts := split $content "## üåè Around the Web" }}
                    {{ if gt (len $parts) 1 }}
                        {{ index $parts 0 | replaceRE "<img ([^>]+)>" "<div class=\"image-wrapper\"><img $1></div>" | safeHTML }}
                        <h2>üåè Around the Web</h2>
                        <ul class="about__sns-list">
                            <li>
                                <a href="https://bere.al/ezeroms" target="_blank" class="about__sns-link icon_bereal">
                                    <span class="about__sns-icon"></span>
                                    <span class="about__sns-name">BeReal</span>
                                </a>
                            </li>
                            <li>
                                <a href="https://bsky.app/profile/ezeroms.bsky.social" target="_blank" class="about__sns-link icon_bluesky">
                                    <span class="about__sns-icon"></span>
                                    <span class="about__sns-name">Bluesky</span>
                                </a>
                            </li>
                            <li>
                                <a href="https://chooning.app/@ezeroms/?hl=ja" target="_blank" class="about__sns-link icon_chooning">
                                    <span class="about__sns-icon"></span>
                                    <span class="about__sns-name">Chooning</span>
                                </a>
                            </li>
                            <li>
                                <a href="https://discord.gg/prmzctxtRe" target="_blank" class="about__sns-link icon_discord">
                                    <span class="about__sns-icon"></span>
                                    <span class="about__sns-name">Discord</span>
                                </a>
                            </li>
                            <li>
                                <a href="https://www.facebook.com/ezeroms/" target="_blank" class="about__sns-link icon_facebook">
                                    <span class="about__sns-icon"></span>
                                    <span class="about__sns-name">Facebook</span>
                                </a>
                            </li>
                            <li>
                                <a href="https://www.instagram.com/ezeroms/" target="_blank" class="about__sns-link icon_instagram">
                                    <span class="about__sns-icon"></span>
                                    <span class="about__sns-name">Instagram</span>
                                </a>
                            </li>
                            <li>
                                <a href="https://open.spotify.com/user/ezeroms" target="_blank" class="about__sns-link icon_spotify">
                                    <span class="about__sns-icon"></span>
                                    <span class="about__sns-name">Spotify</span>
                                </a>
                            </li>
                            <li>
                                <a href="https://www.threads.net/@ezeroms" target="_blank" class="about__sns-link icon_threads">
                                    <span class="about__sns-icon"></span>
                                    <span class="about__sns-name">Threads</span>
                                </a>
                            </li>
                            <li>
                                <a href="https://www.tiktok.com/@ezeroms" target="_blank" class="about__sns-link icon_tiktok">
                                    <span class="about__sns-icon"></span>
                                    <span class="about__sns-name">TikTok</span>
                                </a>
                            </li>
                            <li>
                                <a href="https://x.com/ezeroms" target="_blank" class="about__sns-link icon_x">
                                    <span class="about__sns-icon"></span>
                                    <span class="about__sns-name">X (Twitter)</span>
                                </a>
                            </li>
                        </ul>
                        {{ if gt (len (index $parts 1)) 0 }}
                            {{ index $parts 1 | replaceRE "<img ([^>]+)>" "<div class=\"image-wrapper\"><img $1></div>" | safeHTML }}
                        {{ end }}
                    {{ else }}
                        {{ .Content | replaceRE "<img ([^>]+)>" "<div class=\"image-wrapper\"><img $1></div>" | safeHTML }}
                    {{ end }}
                </article>
            </div>

            <!-- „Åì„ÅÆ„Çµ„Ç§„Éà„Å´„Å§„ÅÑ„Å¶„ÅÆ„Ç≥„É≥„ÉÜ„É≥„ÉÑ -->
            <div id="about-this-site-content" class="about-content" style="display: none;">
                {{ $aboutThisSitePage := .Site.GetPage "/about/about-this-site" }}
                {{ if $aboutThisSitePage }}
                    <article class="article-item">
                        {{ $aboutThisSitePage.Content | replaceRE "<img ([^>]+)>" "<div class=\"image-wrapper\"><img $1></div>" | safeHTML }}
                    </article>
                {{ end }}
            </div>

            <!-- „ÅäÂïè„ÅÑÂêà„Çè„Åõ„ÅÆ„Ç≥„É≥„ÉÜ„É≥„ÉÑ -->
            <div id="contact-content" class="about-content" style="display: none;">
                {{ $contactPage := .Site.GetPage "/about/contact" }}
                {{ if $contactPage }}
                    <article class="article-item">
                        {{ $contactPage.Content | replaceRE "<img ([^>]+)>" "<div class=\"image-wrapper\"><img $1></div>" | safeHTML }}
                    </article>
                {{ end }}
            </div>

            <!-- „É°„Éá„Ç£„Ç¢Êé≤Ëºâ„ÅÆ„Ç≥„É≥„ÉÜ„É≥„ÉÑ -->
            <div id="media-coverage-content" class="about-content" style="display: none;">
                <ul class="article-container column-list">
                    {{ range where .Site.RegularPages "Section" "media-coverage" }}
                        <li class="column-list-item media-coverage-item">
                            <a href="{{ .RelPermalink }}" class="column-card media-coverage-card">
                                {{ if .Params.date }}
                                    <p class="date">{{ .Date | dateFormat "Jan 2" }} ¬∑ {{ .Date | dateFormat "Mon" }} ¬∑ {{ .Date | dateFormat "2006" }}</p>
                                {{ end }}
                                <h3 class="column-card__title">{{ .Title }}</h3>
                                {{ if .Params.lead }}
                                    <p class="media-coverage-card__lead">{{ .Params.lead }}</p>
                                {{ end }}
                            </a>
                        </li>
                    {{ end }}
                </ul>
            </div>
        </div>
    </section>

    <div class="image-loader"></div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const urlParams = new URLSearchParams(window.location.search);
            const section = urlParams.get('section');
            
            const profileContent = document.getElementById('profile-content');
            const aboutThisSiteContent = document.getElementById('about-this-site-content');
            const contactContent = document.getElementById('contact-content');
            const mediaCoverageContent = document.getElementById('media-coverage-content');
            const tocLinks = document.querySelectorAll('.giants-toc__list a');

            function showSection(sectionName) {
                const aboutCover = document.querySelector('.about-cover');
                
                // „Åô„Åπ„Å¶„ÅÆ„Ç≥„É≥„ÉÜ„É≥„ÉÑ„ÇíÈùûË°®Á§∫
                if (profileContent) profileContent.style.display = 'none';
                if (aboutThisSiteContent) aboutThisSiteContent.style.display = 'none';
                if (contactContent) contactContent.style.display = 'none';
                if (mediaCoverageContent) mediaCoverageContent.style.display = 'none';

                // ÈÅ∏Êäû„Åï„Çå„Åü„Çª„ÇØ„Ç∑„Éß„É≥„ÇíË°®Á§∫
                if (sectionName === 'about-this-site') {
                    if (aboutThisSiteContent) aboutThisSiteContent.style.display = 'block';
                    if (aboutCover) aboutCover.style.display = 'none';
                } else if (sectionName === 'contact') {
                    if (contactContent) contactContent.style.display = 'block';
                    if (aboutCover) aboutCover.style.display = 'none';
                } else if (sectionName === 'media-coverage') {
                    if (mediaCoverageContent) mediaCoverageContent.style.display = 'block';
                    if (aboutCover) aboutCover.style.display = 'none';
                } else {
                    // profile („Éá„Éï„Ç©„É´„Éà)
                    if (profileContent) profileContent.style.display = 'block';
                    if (aboutCover) aboutCover.style.display = 'block';
                }

                // ÁõÆÊ¨°„ÅÆ„Ç¢„ÇØ„ÉÜ„Ç£„ÉñÁä∂ÊÖã„ÇíÊõ¥Êñ∞
                tocLinks.forEach(link => {
                    link.classList.remove('active');
                    const href = link.getAttribute('href');
                    if ((sectionName === 'about-this-site' && href.includes('section=about-this-site')) ||
                        (sectionName === 'contact' && href.includes('section=contact')) ||
                        (sectionName === 'media-coverage' && href.includes('section=media-coverage')) ||
                        ((sectionName === 'profile' || !sectionName) && (href === '#profile' || href === '/about/'))) {
                        link.classList.add('active');
                    }
                });
            }

            // URL„Éë„É©„É°„Éº„Çø„Å´Âü∫„Å•„ÅÑ„Å¶„Çª„ÇØ„Ç∑„Éß„É≥„ÇíË°®Á§∫
            if (section === 'about-this-site') {
                showSection('about-this-site');
            } else if (section === 'contact') {
                showSection('contact');
            } else if (section === 'media-coverage') {
                showSection('media-coverage');
            } else {
                showSection('profile');
            }

            // ÁõÆÊ¨°„É™„É≥„ÇØ„ÅÆ„ÇØ„É™„ÉÉ„ÇØ„Ç§„Éô„É≥„Éà
            tocLinks.forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    const href = this.getAttribute('href');
                    
                    if (href.includes('section=about-this-site')) {
                        showSection('about-this-site');
                        window.history.pushState({ section: 'about-this-site' }, '', '/about/?section=about-this-site');
                        const mainContent = document.querySelector('.site-content.is-about .site-main');
                        if (mainContent) {
                            mainContent.scrollTo(0, 0);
                        }
                    } else if (href.includes('section=contact')) {
                        showSection('contact');
                        window.history.pushState({ section: 'contact' }, '', '/about/?section=contact');
                        const mainContent = document.querySelector('.site-content.is-about .site-main');
                        if (mainContent) {
                            mainContent.scrollTo(0, 0);
                        }
                    } else if (href.includes('section=media-coverage')) {
                        showSection('media-coverage');
                        window.history.pushState({ section: 'media-coverage' }, '', '/about/?section=media-coverage');
                        const mainContent = document.querySelector('.site-content.is-about .site-main');
                        if (mainContent) {
                            mainContent.scrollTo(0, 0);
                        }
                    } else if (href === '#profile') {
                        showSection('profile');
                        window.history.pushState({ section: 'profile' }, '', '/about/');
                        const mainContent = document.querySelector('.site-content.is-about .site-main');
                        if (mainContent) {
                            mainContent.scrollTo(0, 0);
                        }
                    }
                });
            });

            // „Éñ„É©„Ç¶„Ç∂„ÅÆÊàª„Çã/ÈÄ≤„ÇÄ„Éú„Çø„É≥„Å´ÂØæÂøú
            window.addEventListener('popstate', function(event) {
                const urlParams = new URLSearchParams(window.location.search);
                const section = urlParams.get('section');
                if (section === 'about-this-site') {
                    showSection('about-this-site');
                } else if (section === 'contact') {
                    showSection('contact');
                } else if (section === 'media-coverage') {
                    showSection('media-coverage');
                } else {
                    showSection('profile');
                }
            });
        });
    </script>

    <!-- debug-info -->
    <p class="debug-info">Template : /layouts/about/list.html</p>
{{ end }}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>{{ if and (eq .Section "diary") .IsPage }}{{ .Date | dateFormat "Jan 2" }} · {{ .Date | dateFormat "2006" }}{{ else }}{{ .Title }}{{ end }}</title>

    <!-- コードブロックのシンタックスハイライト -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/atom-one-dark.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    
    <!-- and it's easy to individually load additional languages -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/go.min.js"></script>
    <script>hljs.highlightAll();</script>

    <link rel="stylesheet" href="{{ "css/main.css" | relURL }}">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <!-- JavaScript -->
    <script>
        // サイトのベースURLをグローバル変数として設定（外部リンク処理で使用）
        window.SITE_BASE_URL = '{{ .Site.BaseURL }}';
    </script>
    <script src="{{ "js/external-links.js" | relURL }}"></script>
    <script src="{{ "js/sidebar-minimize.js" | relURL }}"></script>
    <script src="{{ "js/header-scroll.js" | relURL }}"></script>

    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="{{ "images/common/favicon/favicon.ico" | relURL }}">
    <link rel="icon" type="image/png" sizes="16x16" href="{{ "images/common/favicon/favicon-16x16.png" | relURL }}">
    <link rel="icon" type="image/png" sizes="32x32" href="{{ "images/common/favicon/favicon-32x32.png" | relURL }}">
    <link rel="icon" type="image/png" sizes="96x96" href="{{ "images/common/favicon/favicon-96x96.png" | relURL }}">
    <link rel="icon" type="image/png" sizes="192x192" href="{{ "images/common/favicon/favicon-192x192.png" | relURL }}">
    <link rel="apple-touch-icon" sizes="180x180" href="{{ "images/common/favicon/apple-touch-icon.png" | relURL }}">

    <!-- Open Graph -->
    <meta property="og:title" content="{{ if and (eq .Section "diary") .IsPage }}{{ .Date | dateFormat "Jan 2" }} · {{ .Date | dateFormat "2006" }}{{ else }}{{ .Title }}{{ end }}">
    <meta property="og:description" content="{{ .Site.Params.Description }}">
    <meta property="og:type" content="website">
    <meta property="og:url" content="{{ .Permalink }}">
    <meta property="og:image" content="{{ .Site.BaseURL }}{{ .Site.Params.OgImage }}">
    <meta property="og:site_name" content="{{ .Site.Title }}">
    <meta property="og:locale" content="ja_JP">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="{{ if and (eq .Section "diary") .IsPage }}{{ .Date | dateFormat "Jan 2" }} · {{ .Date | dateFormat "2006" }}{{ else }}{{ .Title }}{{ end }}">
    <meta name="twitter:description" content="{{ .Site.Params.Description }}">
    <meta name="twitter:image" content="{{ .Site.BaseURL }}{{ .Site.Params.OgImage }}">

</head>
{{- $resolvedSection := .Section -}}
{{- if eq .Kind "term" -}}
    {{- $pathParts := split (trim .RelPermalink "/") "/" -}}
    {{- if ge (len $pathParts) 1 -}}
        {{- $resolvedSection = index $pathParts 0 -}}
    {{- end -}}
{{- end -}}
{{- $taxonomySectionMap := dict
    "tweet_tag" "tweet"
    "tweet_month" "tweet"
    "diary_tag" "diary"
    "diary_month" "diary"
    "column_tag" "column"
    "column_category" "column"
    "work_tag" "work"
    "work_month" "work"
    "chronicle_tag" "chronicle"
    "ui_design_guidebook_tag" "ui-design-guidebook"
-}}
{{- with index $taxonomySectionMap $resolvedSection -}}
    {{- $resolvedSection = . -}}
{{- end -}}

{{- $bodyClass := "" -}}
{{- if .IsHome -}}
    {{- $bodyClass = "is-home" -}}
{{- else if eq $resolvedSection "about" -}}
    {{- $bodyClass = "is-about" -}}
{{- else if eq $resolvedSection "media-coverage" -}}
    {{- $bodyClass = "is-about" -}}
{{- else if eq $resolvedSection "column" -}}
    {{- $bodyClass = "is-column" -}}
{{- else if eq $resolvedSection "work" -}}
    {{- $bodyClass = "is-work" -}}
{{- else if eq $resolvedSection "ui-design-guidebook" -}}
    {{- $bodyClass = "is-ui-design-guidebook" -}}
{{- end -}}
<body{{ if $bodyClass }} class="{{ $bodyClass }}"{{ end }}>
    <div class="layout-container">
        <aside class="layout-sidebar" aria-label="グローバルナビゲーション">
            {{ partial "sidebar.html" . }}
        </aside>

        <div class="layout-body">
            {{- /* ヘッダーの表示判定 */ -}}
            {{- $section := $resolvedSection -}}
            {{- $showHeader := and (ne $section "shoulders-of-giants") (ne $section "chronicle") -}}
            {{- if $showHeader -}}
            <div class="layout-header">
                {{ block "section_header" . }}{{ end }}
            </div>
            {{- end -}}
            
            {{- /* レイアウトクラスの決定 */ -}}
            {{- $layoutClass := "" -}}
            {{- if .IsHome -}}
                {{- $layoutClass = "layout-main--centered" -}}
            {{- else if eq $resolvedSection "chronicle" -}}
                {{- $layoutClass = "layout-main--with-toc layout-main--chronicle" -}}
            {{- else if or (eq $resolvedSection "shoulders-of-giants") (eq $resolvedSection "about") (eq $resolvedSection "media-coverage") -}}
                {{- $layoutClass = "layout-main--with-toc" -}}
            {{- else if eq $resolvedSection "ui-design-guidebook" -}}
                {{- $layoutClass = "layout-main--with-header-toc" -}}
            {{- else -}}
                {{- $layoutClass = "layout-main--with-tags" -}}
            {{- end -}}
            
            <div class="layout-main {{ $layoutClass }}">
                {{- /* TOCの表示判定 */ -}}
                {{- if eq $resolvedSection "shoulders-of-giants" -}}
                    {{ partial "giants-toc.html" . }}
                {{- else if eq $resolvedSection "ui-design-guidebook" -}}
                    {{ partial "ui-design-guidebook-toc.html" . }}
                {{- else if or (eq $resolvedSection "about") (eq $resolvedSection "media-coverage") -}}
                    {{ partial "about-toc.html" . }}
                {{- else if eq $resolvedSection "chronicle" -}}
                    {{ partial "chronicle-toc.html" . }}
                {{- end -}}
                
                <main class="layout-main__content" id="main-content">
                    {{ block "main" . }}{{ end }}
                </main>

                {{- /* セカンダリーナビゲーションの表示判定 */ -}}
                {{- $section := $resolvedSection -}}
                {{- $showSecondaryNav := and (ne $section "ui-design-guidebook") (ne $section "about") (ne $section "media-coverage") (ne $section "shoulders-of-giants") (ne $section "chronicle") (not .IsHome) -}}
                {{- if $showSecondaryNav -}}
                <aside class="layout-tags" aria-label="セカンダリーナビゲーション">
                    {{ block "secondary" . }}{{ partial "secondary-nav.html" . }}{{ end }}
                </aside>
                {{- else -}}
                    {{ block "secondary" . }}{{ end }}
                {{- end -}}
            </div>
        </div>
    </div>

    <!-- Google Analytics -->
    {{ partial "google_analytics.html" . }}

</body>
</html>

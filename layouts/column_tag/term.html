{{ define "section_header" }}
    {{ partial "column-header-nav.html" . }}
{{ end }}

{{ define "main" }}
    <section class="page-section">
        <div class="page-section__content">
            <ul class="article-container column-list" id="column-articles-list">
                {{ range .Pages }}
                    {{ $categories := slice }}
                    {{ if .Params.column_category }}
                        {{ $categories = .Params.column_category }}
                    {{ end }}
                    {{ $tags := slice }}
                    {{ if .Params.column_tag }}
                        {{ $tags = .Params.column_tag }}
                    {{ end }}
                    <li class="column-list-item column-item" data-categories="{{ delimit $categories " " }}" data-tags="{{ delimit $tags " " }}">
                        <div class="column-card">
                            <a href="{{ .RelPermalink }}" class="column-card__link">
                                <p class="date">{{ .Date | dateFormat "Jan 2" }} · {{ .Date | dateFormat "Mon" }} · {{ .Date | dateFormat "2006" }}</p>
                                <h3 class="column-card__title">{{ .Title }}</h3>
                            </a>
                            {{ if .Params.column_tag }}
                                <div class="article-header__tags">
                                    {{ $sortedTags := sort .Params.column_tag }}
                                    {{ range $sortedTags }}
                                        <a href="/column_tag/{{ . | urlize }}/" class="tag">{{ . }}</a>
                                    {{ end }}
                                </div>
                            {{ end }}
                        </div>
                    </li>
                {{ end }}
            </ul>
        </div>
    </section>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const categoryFilters = document.getElementById('column-category-filters');
            const columnItems = document.querySelectorAll('.column-list-item');

            // URLパラメータを取得
            const urlParams = new URLSearchParams(window.location.search);
            const urlCategory = urlParams.get('category');

            // 初期状態の決定
            let selectedCategory = urlCategory || 'all';

            function filterByCategory(category) {
                selectedCategory = category;

                // アクティブ状態を更新
                const allTabs = categoryFilters.querySelectorAll('.column-header__tab');
                allTabs.forEach(tab => {
                    if (tab.getAttribute('data-category') === category) {
                        tab.classList.add('active');
                    } else {
                        tab.classList.remove('active');
                    }
                });

                // 記事をフィルタリング
                columnItems.forEach(item => {
                    const itemCategories = item.getAttribute('data-categories').split(' ').filter(c => c);
                    if (category === 'all' || itemCategories.includes(category)) {
                        item.style.display = '';
                    } else {
                        item.style.display = 'none';
                    }
                });

                // 空の状態メッセージを更新

                // URLを更新
                const newURL = window.location.pathname + (category === 'all' ? '' : '?category=' + category);
                window.history.pushState({ category: category }, '', newURL);
            }

            // カテゴリタブのクリックイベント
            const categoryTabs = categoryFilters.querySelectorAll('.column-header__tab');
            categoryTabs.forEach(tab => {
                tab.addEventListener('click', function() {
                    const category = this.getAttribute('data-category');
                    filterByCategory(category);
                });
            });

            // 初期状態の設定
            filterByCategory(selectedCategory);

            // ブラウザの戻る/進むボタンに対応
            window.addEventListener('popstate', function(event) {
                const params = new URLSearchParams(window.location.search);
                const category = params.get('category') || 'all';
                filterByCategory(category);
            });
        });
    </script>
{{ end }}

{{ define "secondary" }}
    {{ partial "column_menu.html" . }}
{{ end }}


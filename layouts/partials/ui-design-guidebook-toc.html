<aside class="layout-toc" aria-label="UI Design Guidebook 目次">
    <nav class="layout-toc__nav">
        <ul class="layout-toc__list">
            {{ $currentPage := . }}
            {{ $isReadmeIndex := or (eq .RelPermalink "/ui-design-guidebook/") (and (.IsSection) (eq .Section "ui-design-guidebook")) }}
            {{ $isReadmePage := false }}
            {{ if .Params.tags }}
                {{ range .Params.tags }}
                    {{ if eq . "readme" }}
                        {{ $isReadmePage = true }}
                    {{ end }}
                {{ end }}
            {{ end }}
            {{ $isReadme := or $isReadmeIndex $isReadmePage }}
            
            {{ if $isReadme }}
                <!-- Readmeページの場合は「目的」「構成」の目次 -->
                {{ $readmePages := where .Site.RegularPages "Section" "ui-design-guidebook" }}
                {{ $readmePages = where $readmePages "Params.tags" "intersect" (slice "readme") }}
                {{ $sortedReadme := sort $readmePages "Params.order" "asc" }}
                {{ range $sortedReadme }}
                    {{ $isActive := false }}
                    {{ if eq $currentPage.RelPermalink .RelPermalink }}
                        {{ $isActive = true }}
                    {{ else if $isReadmeIndex }}
                        {{ $firstReadme := index $sortedReadme 0 }}
                        {{ if eq .RelPermalink $firstReadme.RelPermalink }}
                            {{ $isActive = true }}
                        {{ end }}
                    {{ end }}
                    <li>
                        <a href="{{ .RelPermalink }}" class="{{ if $isActive }}active{{ end }}">{{ .Title }}</a>
                    </li>
                {{ end }}
            {{ else }}
                {{ $currentCategory := "" }}
                {{ if .Params.tags }}
                    {{ range .Params.tags }}
                        {{ if eq . "components" }}
                            {{ $currentCategory = "components" }}
                        {{ else if eq . "patterns" }}
                            {{ $currentCategory = "patterns" }}
                        {{ else if eq . "principles" }}
                            {{ $currentCategory = "principles" }}
                        {{ end }}
                    {{ end }}
                {{ end }}
                
                {{ if eq $currentCategory "components" }}
                    {{ $componentsPages := where .Site.RegularPages "Section" "ui-design-guidebook" }}
                    {{ $componentsPages = where $componentsPages "Params.tags" "intersect" (slice "components") }}
                    {{ $sortedComponents := sort $componentsPages "Params.order" "asc" }}
                    {{ range $sortedComponents }}
                        {{ $isActive := false }}
                        {{ if eq $currentPage.RelPermalink .RelPermalink }}
                            {{ $isActive = true }}
                        {{ end }}
                        <li>
                            <a href="{{ .RelPermalink }}" class="{{ if $isActive }}active{{ end }}">{{ .Title }}</a>
                        </li>
                    {{ end }}
                {{ else if eq $currentCategory "patterns" }}
                    {{ $patternsPages := where .Site.RegularPages "Section" "ui-design-guidebook" }}
                    {{ $patternsPages = where $patternsPages "Params.tags" "intersect" (slice "patterns") }}
                    {{ $sortedPatterns := sort $patternsPages "Params.order" "asc" }}
                    {{ range $sortedPatterns }}
                        {{ $isActive := false }}
                        {{ if eq $currentPage.RelPermalink .RelPermalink }}
                            {{ $isActive = true }}
                        {{ end }}
                        <li>
                            <a href="{{ .RelPermalink }}" class="{{ if $isActive }}active{{ end }}">{{ .Title }}</a>
                        </li>
                    {{ end }}
                {{ else if eq $currentCategory "principles" }}
                    {{ $principlesPages := where .Site.RegularPages "Section" "ui-design-guidebook" }}
                    {{ $principlesPages = where $principlesPages "Params.tags" "intersect" (slice "principles") }}
                    {{ $sortedPrinciples := sort $principlesPages "Params.order" "asc" }}
                    {{ range $sortedPrinciples }}
                        {{ $isActive := false }}
                        {{ if eq $currentPage.RelPermalink .RelPermalink }}
                            {{ $isActive = true }}
                        {{ end }}
                        <li>
                            <a href="{{ .RelPermalink }}" class="{{ if $isActive }}active{{ end }}">{{ .Title }}</a>
                        </li>
                    {{ end }}
                {{ end }}
            {{ end }}
        </ul>
    </nav>
</aside>

